<!-- Generated by: Cerebras (llm_router) -->
# WILLOW CANONICAL STRUCTURE
## Version Information
Version: 2026-02-17
Status: Canonical Training Corpus Reference
Checksum: DeltaSigma=42

## What Willow Is
Willow is the userspace layer of Aionic OS (Human -> SAFE/CPU -> Die-Namic/Kernel -> USB/Bus -> WILLOW/Userspace -> Processes).
Willow is the brain: knows where context lives, controls LLM calls, coordinates 40+ AI processes, routes work to the right persona/destination.

## Layer Map

### BRAIN (core orchestration)
#### Orchestration Components
| File Name | Description |
| --- | --- |
| kart_orchestrator.py | Primary orchestration loop |
| agent_engine.py | Agent conversation management |
| tool_engine.py | Tool dispatch and execution |
| context_injector.py | Context loading for agents |
| conversational_handler.py | Conversation state management |
| user_lattice.py | User context/lattice builder |
| kart_startup.py | Kart initialization |

### FLEET (LLM routing)
#### Routing Components
| File Name | Description |
| --- | --- |
| llm_router.py | 14-provider free fleet cascade |
| litellm_adapter.py | LiteLLM provider adapter |
| provider_health.py | Provider health tracking |
| cost_tracker.py | Token/cost monitoring |
| fleet_feedback.py | Error prevention learning |
| patterns_provider.py | Routing pattern optimization |

### GATEWAY (intake and routing)
#### Intake and Routing Components
| File Name | Description |
| --- | --- |
| aios_loop.py | Main intake loop |
| apps/watcher.py | Google Drive inbox watcher |
| apps/smart_routing.py | Multi-destination file routing |
| core/command_parser.py | CLI command parsing |
| core/shell_adapter.py | Shell command execution |
| core/function_calling.py | Function call dispatch |

### GOVERNANCE (rules and audit)
#### Governance and Audit Components
| File Name | Description |
| --- | --- |
| core/gate.py | Dual Commit gatekeeper v2.1 (IMPLEMENTED) |
| core/state.py | Workflow state machine |
| core/storage.py | Atomic transaction storage |
| core/coherence.py | DeltaE coherence tracking |
| core/aionic_ledger.py | Immutable audit ledger |
| core/checksum_chain.py | Node-to-node checksum chain |
| core/delta_tracker.py | Delta entropy tracking |
| core/recursion_tracker.py | Recursion depth enforcement (depth max=3 generative, max=23 reference) |
| core/consent_gate.py | User consent enforcement |

### AGENTS (AI instances)
#### AI Instance Components
| File Name | Description |
| --- | --- |
| core/agent_engine.py | Agent lifecycle management |
| core/agent_registry.py | Trust levels, tool access, registration |
| core/n2n_db.py | Node-to-node message database |
| core/n2n_packets.py | N2N packet types: BOOTSTRAP/HANDOFF/DELTA/INCIDENT |
| core/seed_packet.py | SEED_PACKET state continuity |
| core/workflow_state.py | Cross-session workflow state |

### STORAGE (persistence)
#### Persistence Components
| File Name | Description |
| --- | --- |
| core/knowledge.py | Knowledge atom DB (SQLite) |
| core/extraction.py | Content extraction from files |
| core/embeddings.py | Vector embeddings |
| core/build_rag_simple.py | RAG index builder (108k chunks indexed) |
| core/conversation_rag.py | Conversation search RAG |

### CLI (interfaces)
#### CLI Components
| File Name | Description |
| --- | --- |
| cli/kart_cli.py | Primary Kart CLI |
| cli/kart_chat.py | Conversational Kart interface |
| cli/kart_exec.py | Task execution CLI |
| cli/terminal_ui.py | Terminal UI components |
| cli/session_manager.py | CLI session management |

### APPS (specialized)
#### Specialized Application Components
| Category | File Name | Description |
| --- | --- | --- |
| Social Media Tracker | apps/social_media_tracker.py | Screenshot + OCR indexing |
| UTETY Faculty Personas | apps/utety_personas.py | 14+ UTETY faculty personas |
| Visual Context (Ra) | apps/observer/ |  |
| Human-controlled OAuth | apps/opauth/ |  |
| Google Drive Organizer | apps/pa/ |  |
| AI Goal Visualization | apps/vision_board/ |  |

### TRAINING (fine-tuning pipelines)
#### Fine-tuning Pipelines Components
| File Name | Description |
| --- | --- |
| training/sean_config.json | Sean voice model 23 domains (TRAINING NOW - Epoch 3) |
| training/sean_finetune_kaggle.ipynb | Sean Kaggle notebook |
| scripts/extract_training_data.py | Extract from conversations |
| scripts/finetune_kart.py | Kart fine-tune pipeline |

## Status

### Implemented and Working

* gate.py Dual Commit governance
* llm_router.py 14-provider free fleet
* agent_engine.py agent conversations
* knowledge.py SQLite knowledge base
* storage.py atomic transactions
* n2n_db.py / n2n_packets.py node-to-node
* RAG database 108k chunks
* Sean fine-tune pipeline (training now)
* Watcher Google Drive inbox monitoring
* Smart routing multi-destination

### Specified But Incomplete

* SEED_PACKET full spec (seed_packet.py exists, DELTA.md generation missing)
* Three-Tier Continuity (Tier 0/1/2 handoff docs not created)
* 23-hop reference traversal (not wired in)
* Lateral review / peer validation (not implemented)
* Daily Intent Triad I0/I1/I2/I3/I4 classification

### Not Yet Built

* Willow fine-tune pipeline (corpus = this repo)
* User registration orchestrator
* Journal UI session-based preference tracking
* Multi-user auth layer

## Models

* Jane (SAFE model) DONE
* Kart (orchestrator) DONE
* Sean (voice model) TRAINING NOW Epoch 3 loss 1.06
* Willow (next) corpus = this repo + conversation logs + specs

### 4% Rule
Max 4% cloud. 96% client-side. User data never touches servers unencrypted.
DeltaSigma=42