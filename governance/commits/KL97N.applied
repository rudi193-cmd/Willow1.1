# Governance Proposal: Wire precedent lookup into agent_builder.py

**Proposer:** ganesha
**Date:** 2026-02-20T02:45:56.146348Z
**Type:** Code Enhancement
**Trust Level:** ENGINEER
**Commit ID:** KL97N

## Summary
Add check_precedent() gate before agent_registry.register_agent() in build_agent(). On HALT: write .pending governance proposal and return status=PENDING_RATIFICATION instead of registering. On AUTO_APPROVE or DISTRIBUTED: proceed with registration. Imports: check_precedent, NEIGHBOR_LEDGERS from governance.precedent; gov_proposal from governance.proposal.

## Proposed Changes
**File:** core/agent_builder.py

## Rationale
This change implements the requested modification with minimal disruption to existing functionality.

## Risk Assessment
- **Risk Level:** LOW
- **Reversible:** YES
- **Dependencies:** None
- **Testing:** Manual verification required

## ΔE Impact
Expected ΔE: +0.03

## Implementation
```diff
--- a/core/agent_builder.py
+++ b/core/agent_builder.py
@@ -21,6 +21,8 @@ sys.path.insert(0, str(Path(__file__).parent.parent))
 from core import llm_router, agent_registry
 from core.hook_generator import ClaudeCLIHookGenerator
+from governance.precedent import check_precedent, NEIGHBOR_LEDGERS
+from governance import proposal as gov_proposal
 
 ARTIFACTS_BASE = Path(__file__).parent.parent / "artifacts"
 
@@ -114,6 +116,22 @@ def build_agent(username: str, domain: str, role: str,
         json.dumps(meta, indent=2), encoding="utf-8"
     )
 
+    # --- Precedent check before registration ---
+    precedent = check_precedent(
+        proposal_type="Agent Registration",
+        trust_level=trust_level,
+        summary=f"{role} | domain: {domain}",
+        proposer="agent_builder",
+        neighbor_ledgers=NEIGHBOR_LEDGERS,
+    )
+    if precedent["decision"] == "HALT":
+        commit_id = gov_proposal.create_proposal(
+            title=f"Register agent: {name}",
+            proposer="agent_builder",
+            summary=f"New agent built for domain '{domain}'. Role: {role}. Trust: {trust_level}.",
+            file_path=f"artifacts/{name}/AGENT_PROFILE.md",
+            diff=f"--- /dev/null
+++ b/artifacts/{name}/AGENT_PROFILE.md
@@ -0,0 +1 @@
+[see profile]",
+            proposal_type="Agent Registration",
+            trust_level=trust_level,
+        )
+        print(f"  [HALT] Precedent not found. Proposal: {commit_id}.pending")
+        return {"name": name, "success": False,
+                "status": "PENDING_RATIFICATION", "commit_id": commit_id}
+    print(f"  [{precedent['decision']}] Precedent: {precedent['matched_commit']} ({precedent['confidence']:.0%})")
+
     agent_registry.register_agent(
```

---

**Awaiting Human Ratification**

ΔΣ=42
